(function(e){var t;var n;var r={init:function(){e(".fes-form").on("click","img.fes-clone-field",this.cloneField);e(".fes-form").on("click","img.fes-remove-field",this.removeField);e(".fes-submission-form").on("submit",this.formSubmit);e(".fes-form-login-form").on("submit",this.formSubmit);e(".fes-profile-form").on("submit",this.formSubmit);e(".fes-form-registration-form").on("submit",this.formSubmit);e(".fes-form-vendor-contact-form").on("submit",this.formSubmit);e(".fes-fields").on("click","a.fes-feat-image-btn",this.featuredImage.addImage);e(".fes-fields").on("click","a.fes-remove-feat-image",this.featuredImage.removeImage);e(".fes-fields").on("click","a.fes-avatar-image-btn",this.avatarImage.addImage);e(".fes-fields").on("click","a.fes-remove-avatar-image",this.avatarImage.removeImage);e(".fes-fields").on("click","a.upload_file_button",this.fileDownloadable);e(".fes-fields").on("click","a.insert-file-row",function(t){t.preventDefault();var n=e(this).attr("id");var r=e("#fes-upload-max-files-"+n).val();var i=e(".fes-variations-list-"+n);var s=i.find(".fes-single-variation:last");var o=s.clone();delete o[1];o.length=1;var u=i.find(".fes-single-variation").length;if(u+1>r&&r!=0){return alert(fes_form.too_many_files_pt_1+r+fes_form.too_many_files_pt_2)}o.find("input, select, textarea").val("");o.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(u)+"]");e(this).attr("name",t).attr("id",t);o.insertBefore("#"+n)});return false});e(".fes-fields").on("click","a.delete",function(t){t.preventDefault();var n=e(this).parents(".fes-single-variation");var r=e(this).parents("[class^=fes-variations-list-]");var i=r.find(".fes-single-variation").length;if(i==1){return alert(fes_form.one_option)}else{n.remove();return false}})},avatarImage:{addImage:function(t){t.preventDefault();var r=e(this);if(n){n.open();return}n=wp.media({title:fes_form.avatar_title,button:{text:fes_form.avatar_button},library:{type:"image"}});n.on("select",function(){var e=n.state().get("selection");e.map(function(e){e=e.toJSON();r.siblings("input.fes-avatar-image-id").val(e.id);var t=r.closest(".instruction-inside");var n=t.siblings(".image-wrap");n.find("img").attr("src",e.url);t.addClass("fes-hide");n.removeClass("fes-hide")})});n.open()},removeImage:function(t){t.preventDefault();var n=e(this);var r=n.closest(".image-wrap");var i=r.siblings(".instruction-inside");i.find("input.fes-avatar-image-id").val("0");r.addClass("fes-hide");i.removeClass("fes-hide")}},fileDownloadable:function(t){t.preventDefault();var n=e(this),r;if(r){r.open();return}r=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:false});r.on("select",function(){var e=r.state().get("selection");e.map(function(e){e=e.toJSON();n.closest("tr").find("input.fes-file-value").val(e.url)})});r.open()},featuredImage:{addImage:function(n){n.preventDefault();var r=e(this);if(t){t.open();return}t=wp.media({title:fes_form.feat_title,button:{text:fes_form.feat_button},library:{type:"image"}});t.on("select",function(){var e=t.state().get("selection");e.map(function(e){e=e.toJSON();r.siblings("input.fes-feat-image-id").val(e.id);var t=r.closest(".instruction-inside");var n=t.siblings(".image-wrap");n.find("img").attr("src",e.url);t.addClass("fes-hide");n.removeClass("fes-hide")})});t.open()},removeImage:function(t){t.preventDefault();var n=e(this);var r=n.closest(".image-wrap");var i=r.siblings(".instruction-inside");i.find("input.fes-feat-image-id").val("0");r.addClass("fes-hide");i.removeClass("fes-hide")}},cloneField:function(t){t.preventDefault();var n=e(this).closest("tr");var r=n.clone();r.find("input").val("");r.find(":checked").attr("checked","");n.after(r)},removeField:function(){var t=e(this).closest("tr");var n=t.siblings().andSelf().length;if(n>1){t.remove()}},formSubmit:function(t){t.preventDefault();var n=e(this),i=n.find(".fes-form-error");submitButton=n.find("input[type=submit]");form_data=r.validateForm(n);if(i.length){i.hide()}if(form_data){n.find("fieldset.fes-submit").append('<span class="fes-loading"></span>');submitButton.attr("disabled","disabled").addClass("button-primary-disabled");e.post(fes_form.ajaxurl,form_data,function(t){if(window.console&&window.console.log){console.log(t)}if(t.success){n.before('<div class="fes-success">'+t.message+"</div>");if(t.is_post){n.slideUp("fast",function(){n.remove()})}e("html, body").animate({scrollTop:e(".fes-success").offset().top-100},"fast");setTimeout(function(){window.location=t.redirect_to},1e3)}else{if(i.length){i.text(t.error);i.show()}else{alert(t.error)}submitButton.removeAttr("disabled")}submitButton.removeClass("button-primary-disabled");n.find("span.fes-loading").remove()})}},validateForm:function(t){var n,i="",s=false,o=[];r.removeErrors(t);r.removeErrorNotice(t);var u=t.find('[data-required="yes"]');u.each(function(t,n){var i=e(n).data("type");a="";switch(i){case"rich":var o=e(n).data("id");a=e.trim(tinyMCE.get(o).getContent());if(a===""){s=true;r.markError(n)}break;case"textarea":case"text":a=e.trim(e(n).val());if(a===""){s=true;r.markError(n)}break;case"select":a=e(n).val();if(!a||a==="-1"){s=true;r.markError(n)}break;case"multiselect":a=e(n).val();if(a===null||a.length===0){s=true;r.markError(n)}break;case"tax-checkbox":var u=e(n).children().find("input:checked").length;if(!u){s=true;r.markError(n)}break;case"radio":var u=e(n).parent().find("input:checked").length;if(!u){s=true;r.markError(n)}break;case"image":var u=e(n).next().val();if(u===null||u===0||u===""||u==="0"){s=true;r.markError(n)}break;case"file":var u=e(n).next("input.fes-file-value").val();if(u===null||u===0||u===""){s=true;r.markError(n)}else{if(!r.isValidURL(u)){s=true;r.markError(n)}}break;case"email":var a=e(n).val();if(a!==""){if(!r.isValidEmail(a)){s=true;r.markError(n)}}break;case"url":var a=e(n).val();if(a!==""){if(!r.isValidURL(a)){s=true;r.markError(n)}}break;case"checkbox":var u=e(n).parent().find("input:checked").length;if(!u){s=true;r.markError(n)}break;case"multiple":var f=e(n).closest(".fes-single-variation").find("input.fes-file-value").val();var l=e(n).closest(".fes-single-variation").find("input.fes-price-value").val();var o=e(n).closest(".fes-single-variation").find("input.fes-name-value").val();var c=false;if(e("#fes-file-row-js").length){c=true}var h=false;if(e("#fes-price-row-js").length){h=true}var p=false;if(e("#fes-name-row-js").length){p=true}if(c&&(f===""||!r.isValidURL(f))){s=true;r.markError(n)}if(h&&l===""){s=true;r.markError(n)}if(p&&o===""){s=true;r.markError(n)}break}});if(s){r.addErrorNotice(t);return false}var a=t.serialize(),f=[];e(".fes-rich-validation").each(function(t,r){n=e(r).data("id");val=e.trim(tinyMCE.get(n).getContent());f.push(n+"="+encodeURIComponent(val))});a=a+"&"+f.join("&");return a},addErrorNotice:function(t){e(t).find("fieldset.fes-submit").append('<div id="fes-error-div" class="fes-error edd_errors">'+fes_form.error_message+"</div>")},removeErrorNotice:function(t){e(t).find("#fes-error-div").remove()},markError:function(t){e(t).closest("fieldset").addClass("has-error");e(t).focus()},removeErrors:function(t){e(t).find(".has-error").removeClass("has-error")},isValidEmail:function(e){var t=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return t.test(e)},isValidURL:function(e){var t=new RegExp("^(http://www.|https://www.|files.|ftp://www.|www.|http://|https://){1}([0-9A-Za-z]+.)|.+.(?:jpg|gif|png|tiff)");return t.test(e)}};e(function(){r.init()})})(jQuery)